<!DOCTYPE html>
<meta charset="utf-5">

<link href="../src/nv.d3.css" rel="stylesheet" type="text/css">

<style>

#chart svg {
  height: 500px;
  width: 800px;
  min-width: 200px;
  min-height: 200px;
}

</style>
<body>

  <div id="chart">
    <svg style="height: 500px;"></svg>
  </div>

<script src="../lib/d3.v2.js"></script>
<script src="../nv.d3.js"></script>
<script src="stream_layers.js"></script>
<script>
var dataset = [4, 4.3, 5.2, 4.6, 4.2, 5.7, 6.1, 7, 5.5, 4.3, 6.1, 7.7, 5, 4, 4.3, 5.2, 4.6, 4.2, 5.7, 6.1, 7, 5.5, 4.3, 6.1, 7.7, 5, 4, 4.3, 5.2, 4.6, 4.2, 5.7, 6.1, 7, 5.5, 4.3, 6.1, 7.7, 5, 5.2, 4.6, 4.2, 5.7, 6.1, 7, 5.5, 4.6, 4.2, 5.7, 5, 4, 4.3, 5.2, 4.6, 4.2, 5.1]

nv.addGraph(function() {
  var chart = nv.models.lineWithFocusChart();

  chart.yAxis
      .tickFormat(d3.format(',.2f'));
  chart.y2Axis
      .tickFormat(d3.format(',.2f'));

  d3.select('#chart svg')
      .datum(testData())
      .transition().duration(500)
      .call(chart);

  return chart;
});

function testData() {
  return stream_layers(2, 200, .1).map(function(d, i) {
    return { 
      key: 'Test Stats',
      values: dataset.map(function(d, i) {
        return {x: i, y: d}
      })
    };
  });
}

function stream_layers(n, m, o) {
  if (arguments.length < 3) o = 0;
  function cow(a) {
    var x = 1 / (.1 + Math.random()),
        y = 2 * Math.random() - .5,
        z = 10 / (.1 + Math.random());
    for (var i = 0; i < m; i++) {
      var w = (i / m - y) * z;
      a[i] += x * Math.exp(-w * w);
    }
  }
  return d3.range(n).map(function() {
      var a = [], i;
      for (i = 0; i < m; i++) a[i] = o + o * Math.random();
      for (i = 0; i < 5; i++) cow(a);
      return a.map(stream_index);
    });
}

function stream_index(d, i) {
  return {x: i, y: Math.max(0, d)};
}

</script>
